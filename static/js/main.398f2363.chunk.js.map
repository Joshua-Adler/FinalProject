{"version":3,"sources":["transpiler.js","components/Preview.js","gl-types.js","components/BlockArea.js","global-consts.js","components/BlockSelector.js","views/Editor.js","views/Login.js","views/Register.js","views/Home.js","components/TopBar.js","App.js","index.js"],"names":["indent","n","repeat","funcToString","func","code","name","actions","actionToString","actStrFuncs","assign","action","indentation","variable","argToString","args","add","subtract","multiply","divide","power","function","output","argsToString","math","type","map","join","arg","isNaN","toString","indexOf","animatePreview","Program","frag","gl","vert","VertexShader","this","program","createProgram","attachShader","shader","linkProgram","useProgram","buildShape","clearColor","clear","COLOR_BUFFER_BIT","viewport","canvas","width","height","drawElements","TRIANGLES","indices","length","UNSIGNED_SHORT","vertex_buffer","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","Float32Array","STATIC_DRAW","Index_Buffer","ELEMENT_ARRAY_BUFFER","Uint16Array","coord","getAttribLocation","vertexAttribPointer","FLOAT","enableVertexAttribArray","Shader","shaderSource","compileShader","errorCheck","err","getShaderInfoLog","console","error","v","loc","getUniformLocation","uniform1f","v0","v1","uniform2f","v2","uniform3f","v3","uniform4f","createShader","VERTEX_SHADER","FragmentShader","FRAGMENT_SHADER","styles","backgroundColor","viewControls","display","justifyContent","controlButton","flexDirection","border","userSelect","marginTop","marginBottom","textAlign","animReqID","anchorTime","Date","now","pauseTime","Preview","props","useState","window","devicePixelRatio","ratio","setRatio","isPaused","setIsPaused","updateRatio","useEffect","cvs","document","getElementById","updateCanvasDims","dims","getBoundingClientRect","Math","round","addEventListener","removeEventListener","useLayoutEffect","getContext","blockData","variables","functions","transpile","blocks","log","cancelAnimationFrame","keepGoing","setUniform2f","setUniform1f","draw","requestAnimationFrame","changeCount","fullscreen","a","requestFullscreen","style","id","onClick","isPanning","baseURL","colors","dispNames","mathFuncs","abs","sign","floor","ceil","fract","min","max","sin","cos","tan","asin","acos","atan","keywords","Set","blockArea","ctx","stencil","panX","panY","zoom","scroll","selectorCategory","mouseX","mouseY","isChrome","navigator","userAgent","primID","argID","dragID","curSelectorBlock","lastFuncIndex","lastActIndex","unsave","changeSelectorCategory","category","drawBlocks","newVariable","prompt","checkName","push","deleteVariable","index","splice","wipeAction","i","freeBlocks","block","Array","isArray","act","newFunction","x","y","str","match","includes","has","dispName","IDColor","override","drawVar","varName","isField","drawText","text","color","save","measureText","fillStyle","fillRect","strokeStyle","strokeRect","fillText","restore","translate","drawAssignMathAction","txt1","txt2","drawAction","alert","drawFunc","metric","rightX","beginPath","moveTo","quadraticCurveTo","lineTo","closePath","fill","stroke","drawFreeBlock","freeBlock","drawSelector","globalAlpha","transY","concat","rel","pos","mouseToCanvas","mathFunc","resetTransform","clearRect","scale","font","updateMouse","e","bounds","left","top","getPositionSelection","pixels","getImageData","data","freq","key","primary","argument","best","handleSelectionAction","value","handleSelection","counter","ret","undefined","deleteFreeBlock","BlockArea","ref","useRef","setWidth","setHeight","createElement","download","link","href","toDataURL","click","updateWindow","current","clientWidth","clientHeight","changeZoom","newScroll","wheelDeltaY","newZoom","panScale","relX","relY","isSaved","setIsSaved","mousedown","sel","setChangeCount","parseFloat","mousemove","movementX","movementY","mouseup","upY","aboveID","blk","f","deleteFunc","blockSelector","fontFamily","button","buttons","BlockSelector","deleteProject","editor","position","overflow","previewWrapper","right","projID","Editor","location","useLocation","baseProject","setBlocks","redir","setRedir","needsLoading","confirm","projName","axios","delete","token","then","response","catch","path","pathname","split","get","setProjName","JSON","parse","title","user","author_id","String","fromCharCode","keyCode","toLowerCase","preventDefault","ctrlKey","blockStr","stringify","post","saveNewProject","patch","project_id","to","loginSchema","Yup","shape","username","required","password","loginInitVals","spaced","field","padding","margin","boxSizing","cursor","fontSize","Login","redirect","setRedirect","setError","initialValues","validationSchema","onSubmit","values","setToken","localStorage","setItem","status","errors","touched","htmlFor","registerSchema","oneOf","registerInitVals","Register","Home","projects","setProjects","marginLeft","marginRight","proj","date","created","toLocaleDateString","nameCol","user_name","className","topBar","barItem","textDecoration","fontWeight","TopBar","removeItem","App","getItem","setUser","isLoaded","setIsLoaded","exact","ReactDOM","render"],"mappings":"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","file":"static/js/main.398f2363.chunk.js","sourcesContent":["export function transpile(blockData) {\r\n\tlet code = '#version 300 es\\nprecision highp float;\\n\\n';\r\n\tcode += 'out vec4 _outColor;\\n\\n';\r\n\tcode += 'uniform float _time;\\n';\r\n\tcode += 'uniform vec2 _window;\\n\\n';\r\n\tfor (let variable of blockData.variables) {\r\n\t\tcode += `float ${variable};\\n`;\r\n\t}\r\n\tcode += '\\n';\r\n\tfor (let func of blockData.functions) {\r\n\t\tif (func.name !== 'main')\r\n\t\t\tcode += `void ${func.name}(int _count);\\n`;\r\n\t}\r\n\tcode += '\\n';\r\n\tfor (let func of blockData.functions) {\r\n\t\tcode += funcToString(func);\r\n\t}\r\n\treturn code;\r\n}\r\n\r\nfunction indent(n) {\r\n\treturn '\\t'.repeat(n);\r\n}\r\n\r\nfunction funcToString(func) {\r\n\tlet code = null;\r\n\t\r\n\tif (func.name === 'main') {\r\n\t\tcode = `void ${func.name}() {\\n`;\r\n\t\tfor (let action of func.actions) {\r\n\t\t\tcode += actionToString(action, 1);\r\n\t\t}\r\n\t} else {\r\n\t\tcode = `void ${func.name}(int _count) {\\n`;\r\n\t\tcode += '\\tfor(int _i = 0; _i < _count; _i++) {\\n';\r\n\t\tfor (let action of func.actions) {\r\n\t\t\tcode += actionToString(action, 2);\r\n\t\t}\r\n\t\tcode += '\\t}\\n';\r\n\t}\r\n\tcode += '}\\n\\n';\r\n\treturn code;\r\n}\r\n\r\nlet actStrFuncs = {\r\n\tassign: (action, indentation) => {\r\n\t\treturn `${indent(indentation)}${action.variable} = ${argToString(action.args[0])};\\n`;\r\n\t},\r\n\tadd: (action, indentation) => {\r\n\t\treturn `${indent(indentation)}${action.variable} += ${argToString(action.args[0])};\\n`;\r\n\t},\r\n\tsubtract: (action, indentation) => {\r\n\t\treturn `${indent(indentation)}${action.variable} -= ${argToString(action.args[0])};\\n`;\r\n\t},\r\n\tmultiply: (action, indentation) => {\r\n\t\treturn `${indent(indentation)}${action.variable} *= ${argToString(action.args[0])};\\n`;\r\n\t},\r\n\tdivide: (action, indentation) => {\r\n\t\treturn `${indent(indentation)}${action.variable} /= ${argToString(action.args[0])};\\n`;\r\n\t},\r\n\tpower: (action, indentation) => {\r\n\t\treturn `${indent(indentation)}${action.variable} = pow(${action.variable}, ${argToString(action.args[0])});\\n`;\r\n\t},\r\n\tfunction: (action, indentation) => {\r\n\t\treturn `${indent(indentation)}${action.name}(int(${action.args[0]}));\\n`\r\n\t},\r\n\toutput: (action, indentation) => {\r\n\t\treturn `${indent(indentation)}_outColor = vec4(${argsToString(action.args)}, 1.);\\n`;\r\n\t},\r\n\tmath: (action, indentation) => {\r\n\t\treturn `${indent(indentation)}${action.variable} = ${action.name}(${argsToString(action.args)});\\n`;\r\n\t}\r\n}\r\n\r\nfunction actionToString(action, indentation) {\r\n\tif(action.name === '_' || action.variable === '_') {\r\n\t\treturn '';\r\n\t}\r\n\tfor(let arg of action.args) {\r\n\t\tif(arg === '_') {\r\n\t\t\treturn '';\r\n\t\t}\r\n\t}\r\n\treturn actStrFuncs[action.type](action, indentation);\r\n}\r\n\r\n// Returns all the args separated by commas\r\nfunction argsToString(args) {\r\n\targs = args.map(argToString);\r\n\treturn args.join(', ');\r\n}\r\n\r\nfunction argToString(arg) {\r\n\tif (!isNaN(arg) && arg.toString().indexOf('.') === -1) {\r\n\t\treturn `${arg}.`;\r\n\t}\r\n\treturn arg;\r\n}","import React, { useState, useEffect, useLayoutEffect } from 'react'\r\n\r\nimport { transpile } from '../transpiler'\r\nimport { Program, FragmentShader } from '../gl-types'\r\n\r\nconst styles = {\r\n\tviewport: {\r\n\t\twidth: '512px',\r\n\t\theight: '288px',\r\n\t\tbackgroundColor: 'black'\r\n\t},\r\n\tviewControls: {\r\n\t\tdisplay: 'flex',\r\n\t\tjustifyContent: 'space-evenly',\r\n\t\tbackgroundColor: '#404040',\r\n\t\theight: '50px'\r\n\t},\r\n\tcontrolButton: {\r\n\t\tbackgroundColor: 'dimgray',\r\n\t\tdisplay: 'flex',\r\n\t\tjustifyContent: 'center',\r\n\t\tflexDirection: 'column',\r\n\t\tborder: '1px solid white',\r\n\t\tuserSelect: 'none',\r\n\t\twidth: '150px',\r\n\t\theight: '35px',\r\n\t\tmarginTop: 'auto',\r\n\t\tmarginBottom: 'auto',\r\n\t\ttextAlign: 'center'\r\n\t}\r\n}\r\n\r\n// ID for the animations being requested so they can be cancelled as needed\r\nvar animReqID = null;\r\n// Time to be marked as 0\r\nvar anchorTime = Date.now();\r\n// Time the user paused at, used for updating anchorTime on unpause\r\nvar pauseTime = 0;\r\n// Needs to be set in a layout effect but accessible globally\r\nvar animatePreview;\r\n\r\nexport default function Preview(props) {\r\n\tconst [ratio, setRatio] = useState(window.devicePixelRatio);\r\n\tconst [isPaused, setIsPaused] = useState(false);\r\n\r\n\tconst updateRatio = () => {\r\n\t\tsetRatio(window.devicePixelRatio);\r\n\t\tanimatePreview(false);\r\n\t}\r\n\r\n\tuseEffect(() => {\r\n\t\tlet cvs = document.getElementById('previewCanvas');\r\n\r\n\t\tconst updateCanvasDims = () => {\r\n\t\t\tlet dims = cvs.getBoundingClientRect();\r\n\t\t\t// Rounding to resolve truncation issues\r\n\t\t\tcvs.width = Math.round(dims.width * ratio);\r\n\t\t\tcvs.height = Math.round(dims.height * ratio);\r\n\t\t}\r\n\r\n\t\twindow.addEventListener('resize', updateRatio);\r\n\t\tcvs.addEventListener('fullscreenchange', updateCanvasDims);\r\n\t\treturn () => {\r\n\t\t\twindow.removeEventListener('resize', updateRatio);\r\n\t\t\tcvs.removeEventListener('fullscreenchange', updateCanvasDims);\r\n\t\t}\r\n\t}, [ratio]);\r\n\r\n\tuseLayoutEffect(() => {\r\n\t\t// Build the shader from the blocks and makes it render in the canvas\r\n\t\tlet cvs = document.getElementById('previewCanvas');\r\n\t\tlet gl = cvs.getContext('webgl2');\r\n\t\tlet code = transpile(props.blocks);\r\n\t\tconsole.log(code);\r\n\t\tlet program = new Program(new FragmentShader(code, gl), gl);\r\n\r\n\t\tif (animReqID !== null) {\r\n\t\t\tcancelAnimationFrame(animReqID);\r\n\t\t}\r\n\r\n\t\tanimatePreview = (keepGoing = true) => {\r\n\t\t\tif (program !== null) {\r\n\t\t\t\tprogram.frag.setUniform2f('_window', cvs.width, cvs.height);\r\n\t\t\t\tif (isPaused) {\r\n\t\t\t\t\tprogram.frag.setUniform1f('_time', (pauseTime - anchorTime) / 1000);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tprogram.frag.setUniform1f('_time', (Date.now() - anchorTime) / 1000);\r\n\t\t\t\t}\r\n\t\t\t\tprogram.draw();\r\n\t\t\t}\r\n\t\t\tif (!isPaused && keepGoing) {\r\n\t\t\t\tanimReqID = requestAnimationFrame(animatePreview);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tanimReqID = requestAnimationFrame(animatePreview);\r\n\t}, [props.blocks, ratio, props.changeCount, isPaused]);\r\n\r\n\tuseEffect(() => {\r\n\t\tanchorTime = Date.now();\r\n\t}, [props.blocks]);\r\n\r\n\tconst play = () => {\r\n\t\tif (animatePreview) {\r\n\t\t\t//animReqID = requestAnimationFrame(animatePreview);\r\n\t\t}\r\n\t\tanchorTime += Date.now() - pauseTime;\r\n\t\tsetIsPaused(false);\r\n\t}\r\n\r\n\tconst pause = () => {\r\n\t\tif (animReqID !== null) {\r\n\t\t\tcancelAnimationFrame(animReqID);\r\n\t\t}\r\n\t\tpauseTime = Date.now();\r\n\t\tsetIsPaused(true);\r\n\t}\r\n\r\n\tconst restart = () => {\r\n\t\tanchorTime = Date.now();\r\n\t\tif(isPaused) {\r\n\t\t\tanimatePreview(false);\r\n\t\t}\r\n\t}\r\n\r\n\tconst fullscreen = async () => {\r\n\t\tlet cvs = document.getElementById('previewCanvas');\r\n\t\tawait cvs.requestFullscreen();\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div style={{ display: 'flex', flexDirection: 'column' }}>\r\n\t\t\t<canvas style={styles.viewport} id='previewCanvas'\r\n\t\t\t\twidth={`${512 * ratio}`} height={`${288 * ratio}`} />\r\n\t\t\t<div style={styles.viewControls}>\r\n\t\t\t\t{isPaused ?\r\n\t\t\t\t\t<div onClick={play} style={styles.controlButton}>Play</div>\r\n\t\t\t\t\t:\r\n\t\t\t\t\t<div onClick={pause} style={styles.controlButton}>Pause</div>\r\n\t\t\t\t}\r\n\t\t\t\t<div onClick={restart} style={styles.controlButton}>Restart</div>\r\n\t\t\t\t<div onClick={fullscreen} style={styles.controlButton}>Full Screen</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t)\r\n}\r\n","export class Program {\r\n\r\n\tconstructor(frag, gl) {\r\n\t\t// Make the vertex shader, it's the same every single time\r\n\t\tlet vert = new VertexShader('#version 300 es\\nprecision highp float;in vec3 _coord;void main(void) {gl_Position = vec4(_coord, 1.0);}', gl)\r\n\t\tthis.gl = gl;\r\n\t\t// Make program\r\n\t\tthis.program = gl.createProgram();\r\n\t\t// Attach shaders\r\n\t\tgl.attachShader(this.program, vert.shader);\r\n\t\tgl.attachShader(this.program, frag.shader);\r\n\t\t// Link program\r\n\t\tgl.linkProgram(this.program);\r\n\t\t// Set the program to be used\r\n\t\tgl.useProgram(this.program);\r\n\t\t// Build the shape (just a square, made of 2 triangles) to be drawn\r\n\t\tthis.buildShape();\r\n\t\t// Make sure that the shader can access the program and vice versa,\r\n\t\t// for uniform setting\r\n\t\tthis.frag = frag;\r\n\t\tfrag.program = this.program;\r\n\t}\r\n\r\n\t// Code in this method has been copied from tutorialspoint\r\n\t// It's not like there's a unique way to do this, anyway\r\n\tdraw() {\r\n\t\t// Clear the canvas\r\n\t\tthis.gl.clearColor(0.2, 0, 0.2, 1);\r\n\t\t// Clear the color buffer bit\r\n\t\tthis.gl.clear(this.gl.COLOR_BUFFER_BIT);\r\n\t\t// Set the view port\r\n\t\tthis.gl.viewport(0, 0, this.gl.canvas.width, this.gl.canvas.height);\r\n\t\t// Draw the triangle\r\n\t\tthis.gl.drawElements(this.gl.TRIANGLES, this.indices.length, this.gl.UNSIGNED_SHORT, 0);\r\n\t}\r\n\r\n\t// Code in this method has been stitched together from tutorialspoint\r\n\t// It's not like there's a unique way to do this, anyway\r\n\tbuildShape() {\r\n\t\tlet vertices = [\r\n\t\t\t-1, 1, 0,\r\n\t\t\t-1, -1, 0,\r\n\t\t\t1, -1, 0,\r\n\t\t\t1, 1, 0\r\n\t\t];\r\n\t\tthis.indices = [3, 2, 1, 3, 1, 0];\r\n\t\t// Create an empty buffer object to store vertex buffer\r\n\t\tlet vertex_buffer = this.gl.createBuffer();\r\n\t\t// Bind appropriate array buffer to it\r\n\t\tthis.gl.bindBuffer(this.gl.ARRAY_BUFFER, vertex_buffer);\r\n\t\t// Pass the vertex data to the buffer\r\n\t\tthis.gl.bufferData(this.gl.ARRAY_BUFFER, new Float32Array(vertices), this.gl.STATIC_DRAW);\r\n\t\t// Unbind the buffer\r\n\t\tthis.gl.bindBuffer(this.gl.ARRAY_BUFFER, null);\r\n\t\t// Create an empty buffer object to store Index buffer\r\n\t\tlet Index_Buffer = this.gl.createBuffer();\r\n\t\t// Bind appropriate array buffer to it\r\n\t\tthis.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER, Index_Buffer);\r\n\t\t// Pass the vertex data to the buffer\r\n\t\tthis.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER, new Uint16Array(this.indices), this.gl.STATIC_DRAW);\r\n\t\t// Unbind the buffer\r\n\t\tthis.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER, null);\r\n\r\n\t\t// Bind vertex buffer object\r\n\t\tthis.gl.bindBuffer(this.gl.ARRAY_BUFFER, vertex_buffer);\r\n\t\t// Bind index buffer object\r\n\t\tthis.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER, Index_Buffer);\r\n\t\t// Get the attribute location\r\n\t\tlet coord = this.gl.getAttribLocation(this.program, '_coord');\r\n\t\t// Point an attribute to the currently bound VBO\r\n\t\tthis.gl.vertexAttribPointer(coord, 3, this.gl.FLOAT, false, 0, 0);\r\n\t\t// Enable the attribute\r\n\t\tthis.gl.enableVertexAttribArray(coord);\r\n\t}\r\n}\r\n\r\nclass Shader {\r\n\r\n\tconstructor(code, shader, gl) {\r\n\t\tthis.shader = shader;\r\n\t\tgl.shaderSource(shader, code);\r\n\t\tgl.compileShader(shader);\r\n\t\tthis.gl = gl;\r\n\t\tthis.errorCheck();\r\n\t}\r\n\r\n\t// Gets the info log and uses it to see if there are any errors\r\n\terrorCheck() {\r\n\t\tlet err = this.gl.getShaderInfoLog(this.shader);\r\n\t\tif (err.length > 0) {\r\n\t\t\tconsole.error('There was a shader error!');\r\n\t\t\tconsole.error(err);\r\n\t\t}\r\n\t}\r\n\r\n\tsetUniform1f(name, v) {\r\n\t\tlet loc = this.gl.getUniformLocation(this.program, name);\r\n\t\tthis.gl.uniform1f(loc, v);\r\n\t}\r\n\r\n\tsetUniform2f(name, v0, v1) {\r\n\t\tlet loc = this.gl.getUniformLocation(this.program, name);\r\n\t\tthis.gl.uniform2f(loc, v0, v1);\r\n\t}\r\n\r\n\tsetUniform3f(name, v0, v1, v2) {\r\n\t\tlet loc = this.gl.getUniformLocation(this.program, name);\r\n\t\tthis.gl.uniform3f(loc, v0, v1, v2);\r\n\t}\r\n\r\n\tsetUniform4f(name, v0, v1, v2, v3) {\r\n\t\tlet loc = this.gl.getUniformLocation(this.program, name);\r\n\t\tthis.gl.uniform4f(loc, v0, v1, v2, v3);\r\n\t}\r\n}\r\n\r\nclass VertexShader extends Shader {\r\n\r\n\tconstructor(code, gl) {\r\n\t\tsuper(code, gl.createShader(gl.VERTEX_SHADER), gl);\r\n\t}\r\n}\r\n\r\nexport class FragmentShader extends Shader {\r\n\r\n\tconstructor(code, gl) {\r\n\t\tsuper(code, gl.createShader(gl.FRAGMENT_SHADER), gl);\r\n\t}\r\n}","// I didn't really have time to plan out this code before making it, so it's a mess. :)\r\n\r\nimport React, { useState, useRef, useLayoutEffect } from 'react'\r\n\r\nimport { mathFuncs, colors, dispNames, keywords } from '../global-consts'\r\n\r\nconst styles = {\r\n\tblockArea: {\r\n\t\twidth: '100%',\r\n\t\tdisplay: 'block',\r\n\t},\r\n\tcanvas: {\r\n\t\twidth: '100%',\r\n\t\theight: '100%'\r\n\t}\r\n}\r\n\r\n// The canvas 2d context\r\nvar ctx = null;\r\n// The context for the stencil canvas used to determine what the user is clicking\r\n// Not quite the same as an actual stencil buffer, but similar\r\nvar stencil = null;\r\n// Variables for controlling the display\r\nvar panX = 0;\r\nvar panY = 0;\r\nvar zoom = 0;\r\nvar isPanning;\r\n// For the block selector\r\nvar scroll = 0;\r\n// Determines which block selection category to show\r\nvar selectorCategory = 'action';\r\n// Keep the blocks in a place that can be globally accessed\r\nvar blocks = null;\r\n// Mouse coordinates\r\nvar mouseX = 0;\r\nvar mouseY = 0;\r\n// Behavior of event.movement<XY> is different in Chrome and Firefox\r\nvar isChrome = navigator.userAgent.indexOf('Chrome') !== -1;\r\n\r\n// The ID system is merely for identifying a given block or group of blocks\r\n// at a given time, it does not guarantee any consistency over time\r\n\r\n// Primary and argument IDs, to be drawn onto the stencil\r\nvar primID = 0;\r\nvar argID = 0;\r\n// (Primary) ID of the block currently being dragged\r\nvar dragID = null;\r\n\r\n// The block that the mouse is over in the selector\r\nvar curSelectorBlock = null;\r\n\r\n// Indices for the last ID handled\r\nvar lastFuncIndex = 0;\r\nvar lastActIndex = 0;\r\n\r\n// To allow unsave() to be called\r\nvar unsave = null;\r\n\r\nexport function changeSelectorCategory(category) {\r\n\tselectorCategory = category;\r\n\tscroll = 0;\r\n\tdrawBlocks();\r\n}\r\n\r\nexport function newVariable() {\r\n\tlet name = prompt(`Variables must\r\n-Start with a letter\r\n-Only contain numbers and letters\r\n-Be unique\r\n-Not be a reserved GLSL keyword`);\r\n\tif (checkName(name)) {\r\n\t\tblocks.variables.push(name);\r\n\t\tdrawBlocks();\r\n\t\tunsave();\r\n\t}\r\n}\r\n\r\nexport function deleteVariable() {\r\n\tlet name = prompt(`Variable name to delete`);\r\n\tlet index = blocks.variables.indexOf(name);\r\n\tif (index === -1) {\r\n\t\treturn;\r\n\t}\r\n\tblocks.variables.splice(index, 1);\r\n\tfor (let func of blocks.functions) {\r\n\t\tfor (let act of func.actions) {\r\n\t\t\twipeAction(act, name);\r\n\t\t}\r\n\t}\r\n\tlet i = 0;\r\n\tfor (let block of blocks.freeBlocks) {\r\n\t\tif (Array.isArray(block)) {\r\n\t\t\tfor (let act of block) {\r\n\t\t\t\twipeAction(act, name);\r\n\t\t\t}\r\n\t\t} else if (block.name === name) {\r\n\t\t\tblocks.freeBlocks.splice(i, 1);\r\n\t\t}\r\n\t\ti++;\r\n\t}\r\n\tdrawBlocks();\r\n\tunsave();\r\n}\r\n\r\nfunction wipeAction(act, name) {\r\n\tif (act.variable === name) {\r\n\t\tact.variable = '_';\r\n\t}\r\n\tif (act.name === name) {\r\n\t\tact.name = '_';\r\n\t}\r\n\tfor (let i = 0; i < act.args.length; i++) {\r\n\t\tif (act.args[i] === name) {\r\n\t\t\tact.args[i] = 1;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport function newFunction() {\r\n\tlet name = prompt(`Functions must\r\n-Start with a letter\r\n-Only contain numbers and letters\r\n-Be unique\r\n-Not be a reserved GLSL keyword`);\r\n\tif (checkName(name)) {\r\n\t\tblocks.functions.push({\r\n\t\t\tname,\r\n\t\t\tx: -panX / 2 ** zoom,\r\n\t\t\ty: -panY / 2 ** zoom,\r\n\t\t\tactions: []\r\n\t\t});\r\n\t\tdrawBlocks();\r\n\t\tunsave();\r\n\t}\r\n}\r\n\r\nfunction checkName(name) {\r\n\tif (validateName(name) && !blocks.variables.includes(name) && !keywords.has(name)) {\r\n\t\tfor (let func of blocks.functions) {\r\n\t\t\tif (func.name === name) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nfunction validateName(str) {\r\n\treturn str !== null && str.match('^[a-zA-Z][a-zA-Z0-9]*$') !== null;\r\n}\r\n\r\n// Returns the display name for a variable,\r\n// which is sometimes different from the actual name\r\nfunction dispName(name) {\r\n\tif (name in dispNames) {\r\n\t\treturn dispNames[name];\r\n\t}\r\n\treturn name;\r\n}\r\n\r\n// Convert the primID and argID into a color\r\nfunction IDColor(override = argID) {\r\n\treturn `rgb(${Math.floor(primID / 256)}, ${primID % 256}, ${override})`;\r\n}\r\n\r\nfunction drawVar(varName, isField = true) {\r\n\tif (isNaN(varName)) {\r\n\t\tif (varName in dispNames) {\r\n\t\t\tdrawText(dispName(varName), colors.input, isField);\r\n\t\t} else {\r\n\t\t\tdrawText(varName, colors.variable, isField);\r\n\t\t}\r\n\t} else {\r\n\t\tdrawText(varName, colors.raw, isField);\r\n\t}\r\n}\r\n\r\n// Draws text in the given color so it looks like an action block\r\n// Will also translate the canvas for repeated calls to keep working\r\nfunction drawText(text, color, isField = false) {\r\n\tctx.save();\r\n\tstencil.save();\r\n\r\n\tlet width = ctx.measureText(text).width;\r\n\tctx.fillStyle = color;\r\n\tctx.fillRect(0, 14, width + 20, -50);\r\n\tif (primID !== dragID) {\r\n\t\tif (isField) {\r\n\t\t\tstencil.fillStyle = IDColor();\r\n\t\t\tstencil.fillRect(0, 14, width + 20, -50);\r\n\t\t\targID++;\r\n\t\t} else {\r\n\t\t\tstencil.fillStyle = IDColor(0);\r\n\t\t\tstencil.fillRect(0, 14, width + 20, -50);\r\n\t\t}\r\n\t}\r\n\tctx.strokeStyle = colors.border;\r\n\tctx.strokeRect(0, 14, width + 20, -50);\r\n\tctx.fillStyle = colors.text;\r\n\tctx.fillText(text, 10, 0);\r\n\r\n\tctx.restore();\r\n\tstencil.restore();\r\n\r\n\tctx.translate(width + 20, 0);\r\n\tstencil.translate(width + 20, 0);\r\n}\r\n\r\nfunction drawAssignMathAction(txt1, variable, txt2, args) {\r\n\tdrawText(txt1, colors.action);\r\n\tdrawVar(variable);\r\n\tdrawText(txt2, colors.action);\r\n\tfor (let arg of args) {\r\n\t\tdrawVar(arg);\r\n\t}\r\n}\r\n\r\nfunction drawAction(action) {\r\n\targID++;\r\n\tctx.save();\r\n\tstencil.save();\r\n\tswitch (action.type) {\r\n\t\tcase 'assign':\r\n\t\t\tdrawAssignMathAction('set', action.variable, 'to', action.args);\r\n\t\t\tbreak;\r\n\t\tcase 'add':\r\n\t\t\tdrawAssignMathAction('add to', action.variable, 'by', action.args);\r\n\t\t\tbreak;\r\n\t\tcase 'subtract':\r\n\t\t\tdrawAssignMathAction('subtract from', action.variable, 'by', action.args);\r\n\t\t\tbreak;\r\n\t\tcase 'multiply':\r\n\t\t\tdrawAssignMathAction('multiply', action.variable, 'by', action.args);\r\n\t\t\tbreak;\r\n\t\tcase 'divide':\r\n\t\t\tdrawAssignMathAction('divide', action.variable, 'by', action.args);\r\n\t\t\tbreak;\r\n\t\tcase 'power':\r\n\t\t\tdrawAssignMathAction('raise', action.variable, 'to the power of', action.args);\r\n\t\t\tbreak;\r\n\t\tcase 'function':\r\n\t\t\tdrawText('run', colors.action);\r\n\t\t\tdrawText(action.name, colors.function, true);\r\n\t\t\tdrawVar(action.args[0]);\r\n\t\t\tdrawText(action.args[0] === 1 ? 'time' : 'times', colors.action);\r\n\t\t\tbreak;\r\n\t\tcase 'output':\r\n\t\t\tdrawText('output color', colors.output);\r\n\t\t\tdrawText('R:', '#A00000');\r\n\t\t\tdrawVar(action.args[0]);\r\n\t\t\tdrawText('G:', '#00A000');\r\n\t\t\tdrawVar(action.args[1]);\r\n\t\t\tdrawText('B:', '#0000A0');\r\n\t\t\tdrawVar(action.args[2]);\r\n\t\t\tbreak;\r\n\t\tcase 'math':\r\n\t\t\tdrawText('set', colors.math);\r\n\t\t\tdrawVar(action.variable);\r\n\t\t\tlet func = mathFuncs[action.name];\r\n\t\t\tif (typeof func === 'string') {\r\n\t\t\t\tdrawText(`to the ${func} of`, colors.math);\r\n\t\t\t\tdrawVar(action.args[0]);\r\n\t\t\t} else {\r\n\t\t\t\tdrawText(`to the ${func[0]} of`, colors.math);\r\n\t\t\t\tfor (let i = 0; i < func[1]; i++) {\r\n\t\t\t\t\tdrawVar(action.args[i]);\r\n\t\t\t\t\tif (i !== func[i] - 1) {\r\n\t\t\t\t\t\tdrawText('and', colors.math);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\tdefault:\r\n\t\t\talert('Error: unrecognized action type ' + action.type);\r\n\t\t\tbreak;\r\n\t}\r\n\tctx.restore();\r\n\tstencil.restore();\r\n\r\n\tctx.translate(0, 50);\r\n\tstencil.translate(0, 50);\r\n\tprimID++;\r\n\targID = 0;\r\n}\r\n\r\nfunction drawFunc(func) {\r\n\tctx.save();\r\n\tstencil.save();\r\n\r\n\tctx.translate(func.x, func.y);\r\n\tstencil.translate(func.x, func.y);\r\n\tlet metric = ctx.measureText(func.name);\r\n\tctx.fillStyle = func.name === 'main' ? colors.main : colors.function;\r\n\tlet rightX = metric.width + 20;\r\n\tstencil.fillStyle = IDColor();\r\n\tctx.beginPath();\r\n\tstencil.beginPath();\r\n\r\n\tctx.moveTo(0, -40);\r\n\tstencil.moveTo(0, -40);\r\n\r\n\tctx.quadraticCurveTo(rightX / 2, -50 - rightX / 10, rightX, -40);\r\n\tstencil.quadraticCurveTo(rightX / 2, -50 - rightX / 10, rightX, -40);\r\n\r\n\tctx.lineTo(rightX, 10);\r\n\tstencil.lineTo(rightX, 10);\r\n\r\n\tctx.lineTo(0, 10);\r\n\tstencil.lineTo(0, 10);\r\n\r\n\tctx.closePath();\r\n\tstencil.closePath();\r\n\r\n\tctx.fill();\r\n\tif (primID !== dragID) {\r\n\t\tstencil.fill();\r\n\t}\r\n\r\n\tctx.strokeStyle = colors.border;\r\n\tctx.stroke();\r\n\tctx.fillStyle = colors.text;\r\n\tctx.fillText(func.name, 10, -4);\r\n\tctx.save();\r\n\tstencil.save();\r\n\r\n\tctx.translate(0, 46);\r\n\tstencil.translate(0, 46);\r\n\tprimID++;\r\n\targID = 0;\r\n\tfor (let action of func.actions) {\r\n\t\tdrawAction(action);\r\n\t}\r\n\tctx.restore();\r\n\tctx.restore();\r\n\tstencil.restore();\r\n\tstencil.restore();\r\n}\r\n\r\nfunction drawFreeBlock(freeBlock) {\r\n\tctx.save();\r\n\tstencil.save();\r\n\r\n\tif (Array.isArray(freeBlock)) {\r\n\t\tctx.translate(freeBlock[0].x, freeBlock[0].y);\r\n\t\tstencil.translate(freeBlock[0].x, freeBlock[0].y);\r\n\t\tfor (let action of freeBlock) {\r\n\t\t\tdrawAction(action);\r\n\t\t}\r\n\t} else {\r\n\t\tctx.translate(freeBlock.x, freeBlock.y);\r\n\t\tstencil.translate(freeBlock.x, freeBlock.y);\r\n\t\tif (freeBlock.type === 'variable') {\r\n\t\t\tdrawVar(freeBlock.name, false);\r\n\t\t} else {\r\n\t\t\tdrawText(freeBlock.name, colors.function);\r\n\t\t}\r\n\t\tprimID++;\r\n\t}\r\n\r\n\tctx.restore();\r\n\tstencil.restore();\r\n}\r\n\r\n// This also handles figuring out what the mouse is over in the selector\r\nfunction drawSelector() {\r\n\tctx.fillStyle = '#303030';\r\n\tlet width = 512 * window.devicePixelRatio;\r\n\tlet height = ctx.canvas.height - 333 * window.devicePixelRatio;\r\n\tctx.fillRect(ctx.canvas.width, ctx.canvas.height, -width, -height);\r\n\tctx.globalAlpha = 1;\r\n\tlet transY = ctx.canvas.height - height;\r\n\tctx.translate(ctx.canvas.width - width, ctx.canvas.height - height);\r\n\tctx.translate(20, 65);\r\n\ttransY += 65;\r\n\tctx.translate(0, scroll);\r\n\ttransY += scroll;\r\n\tcurSelectorBlock = null;\r\n\tif (selectorCategory === 'variable') {\r\n\t\tfor (let variable of ['gl_FragCoord.x', 'gl_FragCoord.y', '_time', '_window.x', '_window.y']\r\n\t\t\t\t.concat(blocks.variables)) {\r\n\t\t\tctx.save();\r\n\t\t\tdrawVar(variable);\r\n\t\t\tctx.restore();\r\n\t\t\tlet rel = transY - mouseY;\r\n\t\t\tif (rel < 35 && rel > -17) {\r\n\t\t\t\tlet pos = mouseToCanvas(mouseX, mouseY);\r\n\t\t\t\tpos.x -= ctx.measureText(dispName(variable)).width / 2;\r\n\t\t\t\tpos.y += 10;\r\n\t\t\t\tcurSelectorBlock = {\r\n\t\t\t\t\t...pos,\r\n\t\t\t\t\ttype: 'variable',\r\n\t\t\t\t\tname: variable\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tctx.translate(0, 60);\r\n\t\t\ttransY += 60;\r\n\t\t}\r\n\t} else if (selectorCategory === 'math') {\r\n\t\tfor (let mathFunc in mathFuncs) {\r\n\t\t\tctx.save();\r\n\t\t\tlet act = {\r\n\t\t\t\tvariable: '_',\r\n\t\t\t\tname: mathFunc,\r\n\t\t\t\ttype: 'math',\r\n\t\t\t\targs: Array.isArray(mathFuncs[mathFunc]) ? [1, 1] : [1]\r\n\t\t\t}\r\n\t\t\tdrawAction(act);\r\n\t\t\tctx.restore();\r\n\t\t\tlet rel = transY - mouseY;\r\n\t\t\tif (rel < 35 && rel > -17) {\r\n\t\t\t\tlet pos = mouseToCanvas(mouseX, mouseY);\r\n\t\t\t\tpos.x -= 50;\r\n\t\t\t\tpos.y += 15;\r\n\t\t\t\tact.x = pos.x;\r\n\t\t\t\tact.y = pos.y;\r\n\t\t\t\tcurSelectorBlock = [act];\r\n\t\t\t}\r\n\t\t\tctx.translate(0, 60);\r\n\t\t\ttransY += 60;\r\n\t\t}\r\n\t} else if (selectorCategory === 'action') {\r\n\t\tlet acts = [\r\n\t\t\t{\r\n\t\t\t\ttype: 'output',\r\n\t\t\t\targs: [0, 0, 0]\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\ttype: 'assign',\r\n\t\t\t\tvariable: '_',\r\n\t\t\t\targs: [0]\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\ttype: 'add',\r\n\t\t\t\tvariable: '_',\r\n\t\t\t\targs: [0]\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\ttype: 'subtract',\r\n\t\t\t\tvariable: '_',\r\n\t\t\t\targs: [0]\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\ttype: 'multiply',\r\n\t\t\t\tvariable: '_',\r\n\t\t\t\targs: [1]\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\ttype: 'divide',\r\n\t\t\t\tvariable: '_',\r\n\t\t\t\targs: [1]\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\ttype: 'power',\r\n\t\t\t\tvariable: '_',\r\n\t\t\t\targs: [1]\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\ttype: 'function',\r\n\t\t\t\tname: '_',\r\n\t\t\t\targs: [1]\r\n\t\t\t}\r\n\t\t]\r\n\t\tfor (let act of acts) {\r\n\t\t\tctx.save();\r\n\t\t\tdrawAction(act);\r\n\t\t\tctx.restore();\r\n\t\t\tlet rel = transY - mouseY;\r\n\t\t\tif (rel < 35 && rel > -17) {\r\n\t\t\t\tlet pos = mouseToCanvas(mouseX, mouseY);\r\n\t\t\t\tpos.x -= 50;\r\n\t\t\t\tpos.y += 15;\r\n\t\t\t\tact.x = pos.x;\r\n\t\t\t\tact.y = pos.y;\r\n\t\t\t\tcurSelectorBlock = [act];\r\n\t\t\t}\r\n\t\t\tctx.translate(0, 60);\r\n\t\t\ttransY += 60;\r\n\t\t}\r\n\t} else {\r\n\t\tfor (let func of blocks.functions) {\r\n\t\t\tfunc = func.name;\r\n\t\t\tif (func !== 'main') {\r\n\t\t\t\tctx.save();\r\n\t\t\t\tdrawText(func, colors.function);\r\n\t\t\t\tctx.restore();\r\n\t\t\t\tlet rel = transY - mouseY;\r\n\t\t\t\tif (rel < 35 && rel > -17) {\r\n\t\t\t\t\tlet pos = mouseToCanvas(mouseX, mouseY);\r\n\t\t\t\t\tpos.x -= ctx.measureText(dispName(func)).width / 2;\r\n\t\t\t\t\tpos.y += 10;\r\n\t\t\t\t\tcurSelectorBlock = {\r\n\t\t\t\t\t\t...pos,\r\n\t\t\t\t\t\ttype: 'function',\r\n\t\t\t\t\t\tname: func\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tctx.translate(0, 60);\r\n\t\t\t\ttransY += 60;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\n// Draws everything that needs to be drawn in the block area canvas\r\n// Also draws the stencil map for clicking\r\nfunction drawBlocks() {\r\n\tprimID = 0;\r\n\targID = 0;\r\n\tctx.resetTransform();\r\n\tstencil.resetTransform();\r\n\tctx.globalAlpha = 1;\r\n\tstencil.globalAlpha = 1;\r\n\tctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n\tstencil.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n\tctx.translate(panX, panY);\r\n\tstencil.translate(panX, panY);\r\n\tlet scale = 2 ** zoom;\r\n\tctx.translate(ctx.canvas.width / 2, ctx.canvas.height / 2);\r\n\tstencil.translate(ctx.canvas.width / 2, ctx.canvas.height / 2);\r\n\tctx.scale(scale, scale);\r\n\tstencil.scale(scale, scale);\r\n\tctx.font = '36px consolas';\r\n\tfor (let func of blocks.functions) {\r\n\t\tdrawFunc(func);\r\n\t}\r\n\tctx.globalAlpha = 0.7;\r\n\tfor (let freeBlock of blocks.freeBlocks) {\r\n\t\tdrawFreeBlock(freeBlock);\r\n\t}\r\n\tctx.resetTransform();\r\n\tstencil.globalAlpha = 0;\r\n\tdrawSelector();\r\n}\r\n\r\nfunction newStencil() {\r\n\tstencil = document.createElement('canvas');\r\n\tstencil.width = ctx.canvas.width;\r\n\tstencil.height = ctx.canvas.height;\r\n\tstencil = stencil.getContext('2d');\r\n}\r\n\r\n// Recalculates the mouse position\r\nfunction updateMouse(e) {\r\n\tlet bounds = ctx.canvas.getBoundingClientRect();\r\n\tmouseX = (e.x - bounds.left) * window.devicePixelRatio;\r\n\tmouseY = (e.y - bounds.top) * window.devicePixelRatio;\r\n}\r\n\r\n// Gets the block ID at the given coordinates\r\nfunction getPositionSelection(x, y) {\r\n\tlet pixels = stencil.getImageData(x - 2, y - 2, 5, 5);\r\n\tif (!pixels || !pixels.data) {\r\n\t\treturn null;\r\n\t}\r\n\tlet freq = {};\r\n\tfor (let i = 0; i < pixels.data.length; i += 4) {\r\n\t\tif (pixels.data[i + 3] === 255) {\r\n\t\t\tlet primary = pixels.data[i] * 256 + pixels.data[i + 1];\r\n\t\t\tlet argument = pixels.data[i + 2];\r\n\t\t\tlet key = primary + argument * 65536;\r\n\t\t\tfreq[key] = freq[key] ? freq[key] + 1 : 1;\r\n\t\t}\r\n\t}\r\n\tlet primary = -1;\r\n\tlet argument = 0;\r\n\tlet best = 0;\r\n\tfor (let key in freq) {\r\n\t\tif (freq[key] > best) {\r\n\t\t\tbest = freq[key];\r\n\t\t\tprimary = key % 65536;\r\n\t\t\targument = Math.floor(key / 65536);\r\n\t\t}\r\n\t}\r\n\treturn primary > -1 ? { primary, argument } : null;\r\n}\r\n\r\nfunction handleSelectionAction(action, argument, value) {\r\n\tif (argument === 0) {\r\n\t\treturn action;\r\n\t}\r\n\tif (action.type === 'output') {\r\n\t\taction.args[argument - 1] = value !== null ? value : action.args[argument - 1];\r\n\t\treturn action.args[argument - 1];\r\n\t} else if (action.type === 'function') {\r\n\t\tif (argument === 1) {\r\n\t\t\taction.name = value !== null ? value : action.name;\r\n\t\t\treturn action.name;\r\n\t\t} else {\r\n\t\t\taction.args[argument - 2] = value !== null ? value : action.args[argument - 2];\r\n\t\t\treturn action.args[argument - 2];\r\n\t\t}\r\n\t} else if (action.type === 'math') {\r\n\t\tif (argument === 1) {\r\n\t\t\taction.variable = value !== null ? value : action.variable;\r\n\t\t\treturn action.variable;\r\n\t\t} else {\r\n\t\t\taction.args[argument - 2] = value !== null ? value : action.args[argument - 2];\r\n\t\t\treturn action.args[argument - 2];\r\n\t\t}\r\n\t} else {\r\n\t\tif (argument === 1) {\r\n\t\t\taction.variable = value !== null ? value : action.variable;\r\n\t\t\treturn action.variable;\r\n\t\t} else {\r\n\t\t\taction.args[argument - 2] = value !== null ? value : action.args[argument - 2];\r\n\t\t\treturn action.args[argument - 2];\r\n\t\t}\r\n\t}\r\n}\r\n\r\n// Convert mouse coordinates to canvas/block coordinates\r\nfunction mouseToCanvas(x, y) {\r\n\treturn {\r\n\t\tx: (x - ctx.canvas.width / 2 - panX) / 2 ** zoom,\r\n\t\ty: (y - ctx.canvas.height / 2 - panY) / 2 ** zoom\r\n\t}\r\n}\r\n\r\n// Returns the selection and changes to value if not null\r\nfunction handleSelection({ primary, argument }, value = null) {\r\n\tlet counter = 0;\r\n\tlastFuncIndex = 0;\r\n\tfor (let func of blocks.functions) {\r\n\t\tif (primary === counter) {\r\n\t\t\tlastActIndex = -1;\r\n\t\t\treturn func;\r\n\t\t}\r\n\t\tif (primary > counter && primary <= counter + func.actions.length) {\r\n\t\t\tlet action = func.actions[primary - 1 - counter];\r\n\t\t\tlastActIndex = primary - 1 - counter;\r\n\t\t\tlet ret = handleSelectionAction(action, argument, value);\r\n\t\t\tif (ret !== undefined) {\r\n\t\t\t\treturn ret;\r\n\t\t\t}\r\n\t\t}\r\n\t\tcounter += func.actions.length + 1;\r\n\t\tlastFuncIndex++;\r\n\t}\r\n\tlastFuncIndex = -1;\r\n\tfor (let freeBlock of blocks.freeBlocks) {\r\n\t\tlastFuncIndex--;\r\n\t\tif (primary === counter && !Array.isArray(freeBlock)) {\r\n\t\t\tlastActIndex = -1;\r\n\t\t\treturn freeBlock;\r\n\t\t}\r\n\t\tif (Array.isArray(freeBlock) && primary >= counter\r\n\t\t\t&& primary < counter + freeBlock.length) {\r\n\t\t\tlet action = freeBlock[primary - counter];\r\n\t\t\tlastActIndex = primary - counter;\r\n\t\t\tlet ret = handleSelectionAction(action, argument, value);\r\n\t\t\tif (ret !== undefined) {\r\n\t\t\t\treturn ret;\r\n\t\t\t}\r\n\t\t}\r\n\t\tcounter += Array.isArray(freeBlock) ? freeBlock.length : 1;\r\n\t}\r\n}\r\n\r\nfunction deleteFreeBlock(block) {\r\n\tlet i = 0;\r\n\tfor (let freeBlock of blocks.freeBlocks) {\r\n\t\tlet b = Array.isArray(freeBlock) ? freeBlock[0] : freeBlock;\r\n\t\tif (b === block) {\r\n\t\t\tblocks.freeBlocks.splice(i, 1);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\ti++;\r\n\t}\r\n}\r\n\r\nfunction deleteFunc(func) {\r\n\tif (func.name === 'main') {\r\n\t\treturn;\r\n\t}\r\n\tlet index = -1;\r\n\tfor (let i = 0; i < blocks.functions.length; i++) {\r\n\t\tif (blocks.functions[i].name === func.name) {\r\n\t\t\tindex = i;\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\tif (index === -1) {\r\n\t\treturn;\r\n\t}\r\n\tblocks.functions.splice(index, 1);\r\n\tfor (let f of blocks.functions) {\r\n\t\tfor (let act of f.actions) {\r\n\t\t\twipeAction(act, func.name);\r\n\t\t}\r\n\t}\r\n\tlet i = 0;\r\n\tfor (let block of blocks.freeBlocks) {\r\n\t\tif (Array.isArray(block)) {\r\n\t\t\tfor (let act of block) {\r\n\t\t\t\twipeAction(act, func.name);\r\n\t\t\t}\r\n\t\t} else if (block.name === func.name) {\r\n\t\t\tblocks.freeBlocks.splice(i, 1);\r\n\t\t}\r\n\t\ti++;\r\n\t}\r\n\ti++;\r\n}\r\n\r\nexport default function BlockArea(props) {\r\n\tconst ref = useRef(null);\r\n\tconst [width, setWidth] = useState(0);\r\n\tconst [height, setHeight] = useState(0);\r\n\tblocks = props.blocks;\r\n\r\n\tuseLayoutEffect(() => {\r\n\t\tctx = document.getElementById('blockCanvas').getContext('2d');\r\n\t\tctx.canvas.width = width * window.devicePixelRatio;\r\n\t\tctx.canvas.height = height * window.devicePixelRatio;\r\n\t\tnewStencil();\r\n\t\trequestAnimationFrame(() => drawBlocks());\r\n\r\n\t\twindow.download = () => {\r\n\t\t\tlet link = document.createElement('a');\r\n\t\t\tlink.download = 'filename.png';\r\n\t\t\tlink.href = stencil.canvas.toDataURL();\r\n\t\t\tlink.click();\r\n\t\t}\r\n\t}, [width, height]);\r\n\r\n\tuseLayoutEffect(() => {\r\n\r\n\t\tconst updateWindow = () => {\r\n\t\t\tsetWidth(ref.current.clientWidth);\r\n\t\t\tsetHeight(ref.current.clientHeight);\r\n\t\t}\r\n\r\n\t\tconst changeZoom = (e) => {\r\n\t\t\tupdateMouse(e);\r\n\t\t\tif ((ctx.canvas.width - mouseX) / window.devicePixelRatio < 512) {\r\n\t\t\t\tlet newScroll = scroll + e.wheelDeltaY / 1;\r\n\t\t\t\tif (newScroll <= 0) {\r\n\t\t\t\t\tscroll = newScroll;\r\n\t\t\t\t\tdrawBlocks();\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tlet newZoom = zoom + e.wheelDeltaY / 500;\r\n\t\t\tif (newZoom <= 3 && newZoom >= -3) {\r\n\t\t\t\tlet panScale = 2 ** newZoom - 2 ** zoom;\r\n\t\t\t\tlet relX = -panX;\r\n\t\t\t\tlet relY = -panY;\r\n\t\t\t\trelX += (mouseX - ctx.canvas.width / 2);\r\n\t\t\t\trelY += (mouseY - ctx.canvas.height / 2);\r\n\t\t\t\tpanX -= relX * panScale / 2 ** zoom;\r\n\t\t\t\tpanY -= relY * panScale / 2 ** zoom;\r\n\t\t\t\tzoom = newZoom;\r\n\t\t\t\tdrawBlocks();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst selectorClick = (e) => {\r\n\t\t\tif (curSelectorBlock !== null) {\r\n\t\t\t\tblocks.freeBlocks.push(curSelectorBlock);\r\n\t\t\t\tdrawBlocks();\r\n\t\t\t\tdragID = getPositionSelection(mouseX, mouseY).primary;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tunsave = () => {\r\n\t\t\tif(props.isSaved !== ' ') {\r\n\t\t\t\tprops.setIsSaved(false);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst mousedown = (e) => {\r\n\t\t\tupdateMouse(e);\r\n\t\t\tdrawSelector();\r\n\t\t\tif ((ctx.canvas.width - mouseX) / window.devicePixelRatio < 512) {\r\n\t\t\t\tselectorClick(e);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tlet id = getPositionSelection(mouseX, mouseY);\r\n\t\t\tif (id != null) {\r\n\t\t\t\tlet sel = handleSelection(id);\r\n\t\t\t\tif (typeof sel !== 'object' && !isNaN(sel)) {\r\n\t\t\t\t\tlet value = prompt('Edit Field', sel);\r\n\t\t\t\t\tif (!isNaN(value) && !isNaN(parseFloat(value))) {\r\n\t\t\t\t\t\thandleSelection(id, value);\r\n\t\t\t\t\t\tdrawBlocks();\r\n\t\t\t\t\t\tprops.setChangeCount(props.changeCount + 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (id.argument === 0) {\r\n\t\t\t\t\t\tif (sel.x !== undefined) {\r\n\t\t\t\t\t\t\tdragID = id.primary;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tlet pos = mouseToCanvas(mouseX, mouseY);\r\n\t\t\t\t\t\t\tpos.x -= 50;\r\n\t\t\t\t\t\t\tpos.y += 15;\r\n\t\t\t\t\t\t\tsel.x = pos.x;\r\n\t\t\t\t\t\t\tsel.y = pos.y;\r\n\t\t\t\t\t\t\tif (lastFuncIndex >= 0) {\r\n\t\t\t\t\t\t\t\tblocks.freeBlocks.push(\r\n\t\t\t\t\t\t\t\t\tblocks.functions[lastFuncIndex].actions.splice(lastActIndex));\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tblocks.freeBlocks.push(\r\n\t\t\t\t\t\t\t\t\tblocks.freeBlocks[-lastFuncIndex - 2].splice(lastActIndex));\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tdrawBlocks();\r\n\t\t\t\t\t\t\tdragID = getPositionSelection(mouseX, mouseY).primary;\r\n\t\t\t\t\t\t\tdrawBlocks();\r\n\t\t\t\t\t\t\tprops.setChangeCount(props.changeCount + 1);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if (sel !== '_') {\r\n\t\t\t\t\t\tlet type = 'variable';\r\n\t\t\t\t\t\tlet action = handleSelection({ primary: id.primary, argument: 0 });\r\n\t\t\t\t\t\tif (action.type === 'function' && id.argument === 1) {\r\n\t\t\t\t\t\t\ttype = 'function';\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tlet pos = mouseToCanvas(mouseX, mouseY);\r\n\t\t\t\t\t\tpos.x -= ctx.measureText(dispName(sel)).width / 2;\r\n\t\t\t\t\t\tpos.y += 10;\r\n\t\t\t\t\t\tblocks.freeBlocks.push({\r\n\t\t\t\t\t\t\ttype,\r\n\t\t\t\t\t\t\tname: sel,\r\n\t\t\t\t\t\t\t...pos\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tdrawBlocks();\r\n\t\t\t\t\t\tdragID = getPositionSelection(mouseX, mouseY).primary;\r\n\t\t\t\t\t\tif (action.type === 'output' || id.argument > 1) {\r\n\t\t\t\t\t\t\thandleSelection(id, 1);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tdrawBlocks();\r\n\t\t\t\t\t\tprops.setChangeCount(props.changeCount + 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tisPanning = true;\r\n\t\t\t}\r\n\t\t\tif(dragID !== null) {\r\n\t\t\t\tunsave();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst mousemove = (e) => {\r\n\t\t\tupdateMouse(e);\r\n\t\t\tif (isPanning) {\r\n\t\t\t\tif (isChrome) {\r\n\t\t\t\t\tpanX += e.movementX;\r\n\t\t\t\t\tpanY += e.movementY;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tpanX += e.movementX * window.devicePixelRatio;\r\n\t\t\t\t\tpanY += e.movementY * window.devicePixelRatio;\r\n\t\t\t\t}\r\n\t\t\t\tdrawBlocks();\r\n\t\t\t} else if (dragID !== null) {\r\n\t\t\t\tunsave();\r\n\t\t\t\tlet block = handleSelection({ primary: dragID, argument: 0 });\r\n\t\t\t\tif (isChrome) {\r\n\t\t\t\t\tblock.x += e.movementX / 2 ** zoom;\r\n\t\t\t\t\tblock.y += e.movementY / 2 ** zoom;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tblock.x += e.movementX * window.devicePixelRatio / 2 ** zoom;\r\n\t\t\t\t\tblock.y += e.movementY * window.devicePixelRatio / 2 ** zoom;\r\n\t\t\t\t}\r\n\t\t\t\tdrawBlocks();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst mouseup = (e) => {\r\n\t\t\tupdateMouse(e);\r\n\t\t\tisPanning = false;\r\n\t\t\tif (dragID !== null) {\r\n\t\t\t\tunsave();\r\n\t\t\t\tlet block = handleSelection({ primary: dragID, argument: 0 });\r\n\t\t\t\tif (block.args) {\r\n\t\t\t\t\tif (mouseX < 0) {\r\n\t\t\t\t\t\tdeleteFreeBlock(block);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet upY = mouseY - 50 * 2 ** zoom;\r\n\t\t\t\t\tlet aboveID = getPositionSelection(mouseX, upY);\r\n\t\t\t\t\tif (aboveID !== null) {\r\n\t\t\t\t\t\tlet above = handleSelection(aboveID);\r\n\t\t\t\t\t\tif (above !== null) {\r\n\t\t\t\t\t\t\tlet freeBlock = null;\r\n\t\t\t\t\t\t\tlet index = 0;\r\n\t\t\t\t\t\t\tfor (let blk of blocks.freeBlocks) {\r\n\t\t\t\t\t\t\t\tif (Array.isArray(blk) && blk[0] === block) {\r\n\t\t\t\t\t\t\t\t\tfreeBlock = blk;\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tindex++;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (lastFuncIndex >= 0) {\r\n\t\t\t\t\t\t\t\tblocks.functions[lastFuncIndex].actions.push(...freeBlock);\r\n\t\t\t\t\t\t\t\tblocks.freeBlocks.splice(index, 1);\r\n\t\t\t\t\t\t\t\tprops.setChangeCount(props.changeCount + 1);\r\n\t\t\t\t\t\t\t\tdelete block.x;\r\n\t\t\t\t\t\t\t\tdelete block.y;\r\n\t\t\t\t\t\t\t} else if (Array.isArray(blocks.freeBlocks[-lastFuncIndex - 2])) {\r\n\t\t\t\t\t\t\t\tblocks.freeBlocks[-lastFuncIndex - 2].push(...freeBlock);\r\n\t\t\t\t\t\t\t\tblocks.freeBlocks.splice(index, 1);\r\n\t\t\t\t\t\t\t\tprops.setChangeCount(props.changeCount + 1);\r\n\t\t\t\t\t\t\t\tdelete block.x;\r\n\t\t\t\t\t\t\t\tdelete block.y;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (block.actions) {\r\n\t\t\t\t\tif (mouseX < 0) {\r\n\t\t\t\t\t\tdeleteFunc(block);\r\n\t\t\t\t\t\tprops.setChangeCount(props.changeCount + 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlet id = getPositionSelection(mouseX, mouseY);\r\n\t\t\t\t\tif (id !== null) {\r\n\t\t\t\t\t\tlet action = handleSelection({ primary: id.primary, argument: 0 });\r\n\t\t\t\t\t\tif (id.argument > 0) {\r\n\t\t\t\t\t\t\tif (block.type === 'function'\r\n\t\t\t\t\t\t\t\t&& action.type === 'function' && id.argument === 1) {\r\n\t\t\t\t\t\t\t\taction.name = block.name;\r\n\t\t\t\t\t\t\t\tdeleteFreeBlock(block);\r\n\t\t\t\t\t\t\t\tprops.setChangeCount(props.changeCount + 1);\r\n\t\t\t\t\t\t\t} else if (block.type === 'variable'\r\n\t\t\t\t\t\t\t\t&& (!(block.name in dispNames || action.type === 'function')\r\n\t\t\t\t\t\t\t\t\t|| id.argument > 1)) {\r\n\t\t\t\t\t\t\t\thandleSelection(id, block.name);\r\n\t\t\t\t\t\t\t\tdeleteFreeBlock(block);\r\n\t\t\t\t\t\t\t\tprops.setChangeCount(props.changeCount + 1);\r\n\t\t\t\t\t\t\t} else if(block.type === 'variable' && action.type === 'output') {\r\n\t\t\t\t\t\t\t\thandleSelection(id, block.name);\r\n\t\t\t\t\t\t\t\tdeleteFreeBlock(block);\r\n\t\t\t\t\t\t\t\tprops.setChangeCount(props.changeCount + 1);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (mouseX < 0) {\r\n\t\t\t\t\t\tdeleteFreeBlock(block);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tdragID = null;\r\n\t\t\tdrawBlocks();\r\n\t\t}\r\n\r\n\t\twindow.addEventListener('resize', updateWindow);\r\n\t\tctx.canvas.addEventListener('wheel', changeZoom);\r\n\t\tdocument.addEventListener('mousemove', mousemove);\r\n\t\tctx.canvas.addEventListener('mousedown', mousedown);\r\n\t\tdocument.addEventListener('mouseup', mouseup);\r\n\t\tupdateWindow();\r\n\t\treturn () => {\r\n\t\t\twindow.removeEventListener('resize', updateWindow);\r\n\t\t\tctx.canvas.removeEventListener('wheel', changeZoom);\r\n\t\t\tdocument.removeEventListener('mousemove', mousemove);\r\n\t\t\tctx.canvas.removeEventListener('mousedown', mousedown);\r\n\t\t\tdocument.removeEventListener('mouseup', mouseup);\r\n\t\t}\r\n\t}, [props]);\r\n\r\n\tuseLayoutEffect(() => {\r\n\t\tblocks = props.blocks;\r\n\t\tpanX = 0;\r\n\t\tpanY = 0;\r\n\t\tzoom = 0;\r\n\t\tdrawBlocks();\r\n\t}, [props.blocks])\r\n\r\n\treturn (\r\n\t\t<div ref={ref} style={styles.blockArea}>\r\n\t\t\t<canvas id=\"blockCanvas\" style={styles.canvas} />\r\n\t\t</div>\r\n\t)\r\n}\r\n","// Base URL for the server\r\nexport const baseURL = 'https://fragflow.herokuapp.com';\r\n// Colors to use for various types of blocks\r\nexport const colors = {function: 'darkcyan', main: 'blueviolet', action: 'midnightblue', text: 'white', raw: 'dimgray', variable: 'darkorange', input: 'orangered', output: 'mediumblue', border: 'white', math: 'green'};\r\n// Names to be replaced when displaying\r\nexport const dispNames = {'_outColor': 'outputColor', 'gl_FragCoord.x': 'pixelX', 'gl_FragCoord.y': 'pixelY', '_window.x': 'windowWidth', '_window.y': 'windowHeight', '_time': 'time'};\r\n// Available math functions that transpile to their GLSL equivalents\r\nexport const mathFuncs = {abs: 'absolute value', sign: 'sign', floor: 'floor', ceil: 'ceiling', fract: 'fractional part', min: ['minimum', 2], max: ['maximum', 2], sin: 'sine', cos: 'cosine', tan: 'tangent', asin: 'arcsine', acos: 'arccosine', atan: ['arctangent', 2], log: 'natural logarithm' };\r\n// All of the reserved keywords in GLSL\r\nexport const keywords = new Set(['attributeq', 'uniform', 'varying', 'layout', 'centroid', 'flat', 'smooth', 'noperspective', 'patch', 'sample', 'subroutine', 'in', 'out', 'inout', 'invariant', 'discard', 'mat2', 'mat3', 'mat4', 'dmat2', 'dmat3', 'dmat4', 'mat2x2', 'mat2x3', 'mat2x4', 'dmat2x2', 'dmat2x3', 'dmat2x4', 'mat3x2', 'mat3x3', 'mat3x4', 'dmat3x2', 'dmat3x3', 'dmat3x4', 'mat4x2', 'mat4x3', 'mat4x4', 'dmat4x2', 'dmat4x3', 'dmat4x4', 'vec2', 'vec3', 'vec4', 'ivec2', 'ivec3', 'ivec4', 'bvec2', 'bvec3', 'bvec4', 'dvec2', 'dvec3', 'dvec4', 'uvec2', 'uvec3', 'uvec4', 'lowp', 'mediump', 'highp', 'precision', 'sampler1D', 'sampler2D', 'sampler3D', 'samplerCube', 'sampler1DShadow', 'sampler2DShadow', 'samplerCubeShadow', 'sampler1DArray', 'sampler2DArray', 'sampler1DArrayShadow', 'sampler2DArrayShadow', 'isampler1D', 'isampler2D', 'isampler3D', 'isamplerCube', 'isampler1DArray', 'isampler2DArray', 'usampler1D', 'usampler2D', 'usampler3D', 'usamplerCube', 'usampler1DArray', 'usampler2DArray', 'sampler2DRect', 'sampler2DRectShadow', 'isampler2DRect', 'usampler2DRect', 'samplerBuffer', 'isamplerBuffer', 'usamplerBuffer', 'sampler2DMS', 'isampler2DMS', 'usampler2DMS', 'sampler2DMSArray', 'isampler2DMSArray', 'usampler2DMSArray', 'samplerCubeArray', 'samplerCubeArrayShadow', 'isamplerCubeArray', 'usamplerCubeArray', 'common', 'partition', 'active', 'asm', 'class', 'union', 'enum', 'typedef', 'template', 'this', 'packed', 'goto', 'inline', 'noinline', 'volatile', 'public', 'static', 'extern', 'external', 'interface', 'long', 'short', 'half', 'fixed', 'unsigned', 'superp', 'input', 'output', 'hvec2', 'hvec3', 'hvec4', 'fvec2', 'fvec3', 'fvec4', 'sampler3DRect', 'filter', 'image1D', 'image2D', 'image3D', 'imageCube', 'iimage1D', 'iimage2D', 'iimage3D', 'iimageCube', 'uimage1D', 'uimage2D', 'uimage3D', 'uimageCube', 'image1DArray', 'image2DArray', 'iimage1DArray', 'iimage2DArray', 'uimage1DArray', 'uimage2DArray', 'image1DShadow', 'image2DShadow', 'image1DArrayShadow', 'image2DArrayShadow', 'imageBuffer', 'iimageBuffer', 'uimageBuffer', 'sizeof', 'cast', 'namespace', 'using', 'row_major']);","import React from 'react'\r\n\r\nimport { colors } from '../global-consts'\r\nimport { changeSelectorCategory, newVariable, deleteVariable, newFunction } from './BlockArea'\r\n\r\nconst styles = {\r\n\tblockSelector: {\r\n\t\tbackgroundColor: '#151515',\r\n\t\twidth: '200px',\r\n\t\tdisplay: 'flex',\r\n\t\tflexDirection: 'column',\r\n\t\tjustifyContent: 'end',\r\n\t},\r\n\tcategory: {\r\n\t\theight: '100px',\r\n\t\ttextAlign: 'center',\r\n\t\tdisplay: 'flex',\r\n\t\tflexDirection: 'column',\r\n\t\tjustifyContent: 'center',\r\n\t\tfontFamily: 'consolas',\r\n\t\tuserSelect: 'none',\r\n\t\tborder: '1px solid white'\r\n\t},\r\n\tbutton: {\r\n\t\theight: '50px',\r\n\t\tborder: '1px solid white',\r\n\t\tdisplay: 'flex',\r\n\t\tflexDirection: 'column',\r\n\t\tjustifyContent: 'center',\r\n\t\tuserSelect: 'none'\r\n\t},\r\n\tbuttons: {\r\n\t\tmarginBottom: 'auto',\r\n\t\tjustifyContent: 'space-between',\r\n\t\tborder: 'none',\r\n\t\theight: '200px'\r\n\t}\r\n}\r\n\r\nexport default function BlockSelector() {\r\n\treturn (\r\n\t\t<div style={styles.blockSelector}>\r\n\t\t\t<div style={{ ...styles.category, ...styles.buttons}}>\r\n\t\t\t\t<div style={{ ...styles.button, backgroundColor: colors.variable }} onClick={newVariable}>New Variable</div>\r\n\t\t\t\t<div style={{ ...styles.button, backgroundColor: colors.function }} onClick={newFunction}>New Function</div>\r\n\t\t\t\t<div style={{ ...styles.button, backgroundColor: colors.variable }} onClick={deleteVariable}>Delete Variable</div>\r\n\t\t\t</div>\r\n\t\t\t<div onClick={() => changeSelectorCategory('function')} style={{\r\n\t\t\t\t...styles.category,\r\n\t\t\t\tbackgroundColor: colors.function\r\n\t\t\t}}>Functions</div>\r\n\t\t\t<div onClick={() => changeSelectorCategory('action')} style={{\r\n\t\t\t\t...styles.category,\r\n\t\t\t\tbackgroundColor: colors.action\r\n\t\t\t}}>Actions</div>\r\n\t\t\t<div onClick={() => changeSelectorCategory('variable')} style={{\r\n\t\t\t\t...styles.category,\r\n\t\t\t\tbackgroundColor: colors.variable\r\n\t\t\t}}>Variables</div>\r\n\t\t\t<div onClick={() => changeSelectorCategory('math')} style={{\r\n\t\t\t\t...styles.category,\r\n\t\t\t\tbackgroundColor: colors.math\r\n\t\t\t}}>Math</div>\r\n\t\t</div>\r\n\t)\r\n}\r\n","import React, { useState, useEffect, useRef } from 'react'\r\nimport { useLocation, Redirect } from 'react-router-dom'\r\nimport axios from 'axios'\r\n\r\nimport Preview from '../components/Preview'\r\nimport BlockArea from '../components/BlockArea'\r\nimport BlockSelector from '../components/BlockSelector'\r\n\r\nimport baseProject from '../data/base.json'\r\n\r\nimport { baseURL } from './../global-consts'\r\n\r\nconst styles = {\r\n\teditor: {\r\n\t\tposition: 'relative',\r\n\t\theight: '100%',\r\n\t\tdisplay: 'flex',\r\n\t\tfontFamily: 'consolas',\r\n\t\toverflow: 'hidden'\r\n\t},\r\n\tpreviewWrapper: {\r\n\t\tposition: 'absolute',\r\n\t\tright: '0px',\r\n\t\ttop: '0px'\r\n\t}\r\n}\r\n\r\nvar projID = 'new';\r\n\r\nexport var deleteProject;\r\n\r\nexport default function Editor(props) {\r\n\tconst location = useLocation();\r\n\tconst [blocks, setBlocks] = useState(baseProject);\r\n\tconst [changeCount, setChangeCount] = useState(0);\r\n\tconst [redir, setRedir] = useState(null);\r\n\tconst needsLoading = useRef(true);\r\n\r\n\tdeleteProject = () => {\r\n\t\tif(window.confirm(`Delete ${props.projName}? This action can not be undone.`)) {\r\n\t\t\taxios.delete(`${baseURL}/api/project?id=${projID}&token=${props.token}`)\r\n\t\t\t.then((response) => {\r\n\t\t\t\tsetRedir('');\r\n\t\t\t}).catch((error) => {\r\n\t\t\t\talert('There was an error deleting the project.');\r\n\t\t\t\tconsole.error(error);\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\r\n\t// Shut up, there is no infinite loop\r\n\t// eslint-disable-next-line\r\n\tuseEffect(() => {\r\n\t\tif (needsLoading.current) {\r\n\t\t\tneedsLoading.current = false;\r\n\t\t\tlet path = location.pathname.split('/');\r\n\t\t\tprojID = path[path.length - 1];\r\n\t\t\tif (projID !== 'new') {\r\n\t\t\t\taxios.get(`${baseURL}/api/project?id=${projID}`).then((response) => {\r\n\t\t\t\t\tprops.setProjName(response.data.name);\r\n\t\t\t\t\tsetBlocks(JSON.parse(response.data.blocks));\r\n\t\t\t\t\tdocument.title = `Fragflow | ${response.data.name}`;\r\n\t\t\t\t\tif (props.token && props.user.id === response.data.author_id) {\r\n\t\t\t\t\t\tprops.setIsSaved('Saved');\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tprops.setIsSaved(' ');\r\n\t\t\t\t\t}\r\n\t\t\t\t}).catch((error) => {\r\n\t\t\t\t\tsetRedir('editor/new');\r\n\t\t\t\t\tneedsLoading.current = true;\r\n\t\t\t\t})\r\n\t\t\t\tdocument.title = 'Fragflow | Loading...';\r\n\t\t\t} else {\r\n\t\t\t\tsetBlocks(baseProject);\r\n\t\t\t\tprops.setProjName('Untitled Project');\r\n\t\t\t\tif (props.token) {\r\n\t\t\t\t\tprops.setIsSaved(false);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tprops.setIsSaved(' ');\r\n\t\t\t\t}\r\n\t\t\t\tdocument.title = `Fragflow | Untitled Project`;\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\tuseEffect(() => {\r\n\t\tconst saveNewProject = (name) => {\r\n\t\t\tlet blockStr = JSON.stringify(blocks);\r\n\t\t\taxios.post(`${baseURL}/api/project`, {\r\n\t\t\t\ttoken: props.token,\r\n\t\t\t\tblocks: blockStr,\r\n\t\t\t\tname\r\n\t\t\t}).then((response) => {\r\n\t\t\t\tsetRedir(`editor/${response.data.id}`);\r\n\t\t\t\tneedsLoading.current = true;\r\n\t\t\t}).catch((error) => {\r\n\t\t\t\talert('There was an error saving your project.');\r\n\t\t\t\tconsole.log(error);\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\tconst saveProject = () => {\r\n\t\t\taxios.patch(`${baseURL}/api/project`, {\r\n\t\t\t\ttoken: props.token,\r\n\t\t\t\tproject_id: projID,\r\n\t\t\t\tblocks: JSON.stringify(blocks)\r\n\t\t\t}).then((response) => {\r\n\t\t\t\tprops.setIsSaved('Saved');\r\n\t\t\t}).catch((error) => {\r\n\t\t\t\talert('There was an error saving your project.');\r\n\t\t\t\tprops.setIsSaved(null);\r\n\t\t\t\tconsole.log(error);\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\tconst save = (e) => {\r\n\t\t\tlet key = String.fromCharCode(e.keyCode).toLowerCase();\r\n\t\t\tif (key === 's') {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tif (props.isSaved !== 'Saved' && e.ctrlKey) {\r\n\t\t\t\t\tif (props.isSaved === false) {\r\n\t\t\t\t\t\tif (projID === 'new') {\r\n\t\t\t\t\t\t\tlet name = prompt('Project Name');\r\n\t\t\t\t\t\t\tif (name !== null && name.length > 0) {\r\n\t\t\t\t\t\t\t\twhile (name === null || name.length > 32) {\r\n\t\t\t\t\t\t\t\t\tname = prompt('Project Name (less than 33 characters)');\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tprops.setIsSaved('Saving...');\r\n\t\t\t\t\t\t\t\tsaveNewProject(name);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tprops.setIsSaved('Saving...');\r\n\t\t\t\t\t\t\tsaveProject();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\twindow.addEventListener('keydown', save);\r\n\t\treturn () => {\r\n\t\t\twindow.removeEventListener('keydown', save);\r\n\t\t}\r\n\t});\r\n\r\n\treturn (\r\n\t\t<div style={styles.editor}>\r\n\t\t\t{redir !== null ?\r\n\t\t\t\t<Redirect to={{ pathname: `/FinalProject/${redir}` }} />\r\n\t\t\t\t: ''}\r\n\t\t\t<BlockSelector />\r\n\t\t\t<BlockArea blocks={blocks} changeCount={changeCount} setChangeCount={setChangeCount}\r\n\t\t\t\tisSaved={props.isSaved} setIsSaved={props.setIsSaved} />\r\n\t\t\t<div style={styles.previewWrapper}>\r\n\t\t\t\t<Preview blocks={blocks} changeCount={changeCount} />\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t)\r\n}\r\n","import React, { useState, useEffect } from 'react'\r\nimport * as Yup from 'yup'\r\nimport { Formik, Form, Field } from 'formik'\r\nimport { Redirect } from 'react-router-dom'\r\nimport axios from 'axios'\r\n\r\nimport { baseURL } from '../global-consts'\r\n\r\nconst loginSchema = Yup.object().shape({\r\n\tusername: Yup.string().required('Required'),\r\n\tpassword: Yup.string().required('Required'),\r\n});\r\n\r\nconst loginInitVals = {\r\n\tusername: '',\r\n\tpassword: '',\r\n}\r\n\r\nexport const styles = {\r\n\terror: {\r\n\t\tcolor: '#F76356',\r\n\t\tposition: 'absolute'\r\n\t},\r\n\tspaced: {\r\n\t\tmarginTop: '40px'\r\n\t},\r\n\t// Form styles modified from w3schools\r\n\tfield: {\r\n\t\twidth: '100%',\r\n\t\tpadding: '12px 20px',\r\n\t\tmargin: '8px 0',\r\n\t\tdisplay: 'inline-block',\r\n\t\tborder: '1px solid dimgray',\r\n\t\tboxSizing: 'border-box',\r\n\t\tbackgroundColor: '#131313',\r\n\t\tcolor: 'white'\r\n\t},\r\n\tbutton: {\r\n\t\twidth: '50%',\r\n\t\tbackgroundColor: '#4d54d6',\r\n\t\tcolor: 'white',\r\n\t\tpadding: '14px 20px',\r\n\t\tborder: 'none',\r\n\t\tcursor: 'pointer',\r\n\t\tfontSize: '100%'\r\n\t}\r\n}\r\n\r\nexport default function Login(props) {\r\n\tconst [redirect, setRedirect] = useState(false);\r\n\tconst [error, setError] = useState('')\r\n\r\n\tuseEffect(() => {\r\n\t\tdocument.title = 'Fragflow | Login';\r\n\t});\r\n\r\n\tconst handleSubmit = (username, password) => {\r\n\t\tsetError('');\r\n\t\taxios.post(`${baseURL}/api/login`, {\r\n\t\t\tusername: username,\r\n\t\t\tpassword: password\r\n\t\t}).then((response) => {\r\n\t\t\tprops.setToken(response.data.token);\r\n\t\t\tlocalStorage.setItem('token', response.data.token);\r\n\t\t\tsetRedirect(true);\r\n\t\t}).catch((error) => {\r\n\t\t\tswitch (error.response.status) {\r\n\t\t\t\tcase 400:\r\n\t\t\t\t\tsetError('Username and password are required');\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 401:\r\n\t\t\t\t\tsetError('Incorrect password');\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 404:\r\n\t\t\t\t\tsetError('User does not exist');\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tsetError('Unknown error');\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div style={{ margin: 'auto', marginTop: '100px', width: '50vw' }}>\r\n\t\t\t{redirect ? <Redirect to={{ pathname: '/FinalProject/' }} /> : null}\r\n\t\t\t<h1 style={{ textAlign: 'center' }}>Login</h1>\r\n\t\t\t<Formik initialValues={loginInitVals} validationSchema={loginSchema}\r\n\t\t\t\tonSubmit={(values) => handleSubmit(values.username, values.password)}>\r\n\t\t\t\t{({ errors, touched }) => (\r\n\t\t\t\t\t<Form>\r\n\t\t\t\t\t\t<label style={styles.spaced} htmlFor='username'>Username </label>\r\n\t\t\t\t\t\t<Field style={styles.field} name='username' />\r\n\t\t\t\t\t\t{errors.username && touched.username ?\r\n\t\t\t\t\t\t\t<div style={styles.error}>{errors.username}</div> : null}\r\n\t\t\t\t\t\t<br />\r\n\t\t\t\t\t\t<br />\r\n\t\t\t\t\t\t<br />\r\n\t\t\t\t\t\t<label style={styles.spaced} htmlFor='password'>Password </label>\r\n\t\t\t\t\t\t<Field style={styles.field} type='password' name='password' />\r\n\t\t\t\t\t\t{errors.password && touched.password ?\r\n\t\t\t\t\t\t\t<div style={styles.error}>{errors.password}</div> : null}\r\n\t\t\t\t\t\t<br />\r\n\t\t\t\t\t\t<br />\r\n\t\t\t\t\t\t<br />\r\n\t\t\t\t\t\t<div style={{ display: 'flex', justifyContent: 'center' }}>\r\n\t\t\t\t\t\t\t<button style={{ ...styles.button }} type='submit'>Log In</button>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</Form>\r\n\t\t\t\t)}\r\n\t\t\t</Formik>\r\n\t\t\t<h5 style={{ ...styles.error, ...styles.spaced }}>{error}</h5>\r\n\t\t</div>\r\n\t)\r\n}\r\n","import React, { useState, useEffect } from 'react'\r\nimport * as Yup from 'yup'\r\nimport { Formik, Form, Field } from 'formik'\r\nimport { Redirect } from 'react-router-dom'\r\nimport axios from 'axios'\r\n\r\nimport { baseURL } from '../global-consts'\r\nimport { styles } from './Login'\r\n\r\nconst registerSchema = Yup.object().shape({\r\n\tusername: Yup.string().required('Required'),\r\n\tpassword: Yup.string().required('Required'),\r\n\tconfirm: Yup.string().required('Required').oneOf([Yup.ref('password')], 'Must match password')\r\n});\r\n\r\nconst registerInitVals = {\r\n\tusername: '',\r\n\tpassword: '',\r\n\tconfirm: ''\r\n}\r\n\r\nexport default function Register(props) {\r\n\tconst [redirect, setRedirect] = useState(false);\r\n\tconst [error, setError] = useState('')\r\n\r\n\tuseEffect(() => {\r\n\t\tdocument.title = 'Fragflow | Register';\r\n\t});\r\n\r\n\tconst handleSubmit = (username, password) => {\r\n\t\tsetError('');\r\n\t\taxios.post(`${baseURL}/api/register`, {\r\n\t\t\tusername: username,\r\n\t\t\tpassword: password\r\n\t\t}).then((response) => {\r\n\t\t\tprops.setToken(response.data.token);\r\n\t\t\tlocalStorage.setItem('token', response.data.token);\r\n\t\t\tsetRedirect(true);\r\n\t\t}).catch((error) => {\r\n\t\t\tswitch (error.response.status) {\r\n\t\t\t\tcase 400:\r\n\t\t\t\t\tsetError('Username and password are required');\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 409:\r\n\t\t\t\t\tsetError('That username is taken');\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tsetError('Unknown error');\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div style={{ margin: 'auto', marginTop: '100px', width: '50vw' }}>\r\n\t\t\t{redirect ? <Redirect to={{ pathname: '/FinalProject/' }} /> : null}\r\n\t\t\t<h1 style={{ textAlign: 'center' }}>Registration</h1>\r\n\t\t\t<Formik initialValues={registerInitVals}\r\n\t\t\t\tvalidationSchema={registerSchema}\r\n\t\t\t\tonSubmit={(values) => handleSubmit(values.username, values.password)}>\r\n\t\t\t\t{({ errors, touched }) => (\r\n\t\t\t\t\t<Form>\r\n\t\t\t\t\t\t<label style={styles.spaced} htmlFor='username'>Username </label>\r\n\t\t\t\t\t\t<Field style={styles.field} name='username' />\r\n\t\t\t\t\t\t{errors.username && touched.username ?\r\n\t\t\t\t\t\t\t<div style={styles.error}>{errors.username}</div> : null}\r\n\t\t\t\t\t\t<br />\r\n\t\t\t\t\t\t<br />\r\n\t\t\t\t\t\t<br />\r\n\t\t\t\t\t\t<label style={styles.spaced} htmlFor='password'>Password </label>\r\n\t\t\t\t\t\t<Field style={styles.field} type='password' name='password' />\r\n\t\t\t\t\t\t{errors.password && touched.password ?\r\n\t\t\t\t\t\t\t<div style={styles.error}>{errors.password}</div> : null}\r\n\t\t\t\t\t\t<br />\r\n\t\t\t\t\t\t<br />\r\n\t\t\t\t\t\t<br />\r\n\t\t\t\t\t\t<label style={styles.spaced} htmlFor='confirm'>Confirm Password </label>\r\n\t\t\t\t\t\t<Field style={styles.field} type='password' name='confirm' />\r\n\t\t\t\t\t\t{errors.confirm && touched.confirm ?\r\n\t\t\t\t\t\t\t<div style={styles.error}>{errors.confirm}</div> : null}\r\n\t\t\t\t\t\t<br />\r\n\t\t\t\t\t\t<br />\r\n\t\t\t\t\t\t<br />\r\n\t\t\t\t\t\t<div style={{ display: 'flex', justifyContent: 'center' }}>\r\n\t\t\t\t\t\t\t<button style={{ ...styles.button, fontSize: '100%' }} type='submit'>Register</button>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</Form>\r\n\t\t\t\t)}\r\n\t\t\t</Formik>\r\n\t\t\t<h5 style={{ ...styles.error, ...styles.spaced }}>{error}</h5>\r\n\t\t</div>\r\n\t)\r\n}\r\n","import React, { useEffect, useState } from 'react'\r\nimport { Redirect } from 'react-router-dom'\r\nimport axios from 'axios'\r\n\r\nimport { baseURL } from './../global-consts'\r\n\r\nexport default function Home(props) {\r\n\tconst [projects, setProjects] = useState([]);\r\n\tconst [redir, setRedir] = useState(null);\r\n\r\n\tuseEffect(() => {\r\n\t\tdocument.title = 'Fragflow | Home'\r\n\t\tif (projects.length === 0) {\r\n\t\t\taxios.get(`${baseURL}/api/projects`)\r\n\t\t\t\t.then((response) => {\r\n\t\t\t\t\tsetProjects(response.data.projects);\r\n\t\t\t\t}).catch((error) => {\r\n\t\t\t\t\tconsole.error(error);\r\n\t\t\t\t});\r\n\t\t}\r\n\t}, [projects]);\r\n\r\n\treturn (\r\n\t\t<div style={{ marginLeft: 'auto', marginRight: 'auto', marginTop: '100px' }}>\r\n\t\t\t{redir ? <Redirect to={{ pathname: `/FinalProject/editor/${redir}` }} /> : ''}\r\n\t\t\t<table>\r\n\t\t\t\t<thead>\r\n\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t<th>Author</th>\r\n\t\t\t\t\t\t<th style={{ width: '50%' }}>Name</th>\r\n\t\t\t\t\t\t<th>Date Created</th>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</thead>\r\n\t\t\t\t<tbody>\r\n\t\t\t\t\t{projects.map((proj) => {\r\n\t\t\t\t\t\tlet date = new Date(proj.created).toLocaleDateString();\r\n\t\t\t\t\t\tlet nameCol = 'white';\r\n\t\t\t\t\t\tif (props.token && props.user.name === proj.user_name) {\r\n\t\t\t\t\t\t\tnameCol = '#4F4';\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\t<tr key={proj.id} onClick={() => setRedir(proj.id)} className='projectData'>\r\n\t\t\t\t\t\t\t\t<td style={{ color: nameCol }}>{proj.user_name}</td>\r\n\t\t\t\t\t\t\t\t<td>{proj.name}</td>\r\n\t\t\t\t\t\t\t\t<td>{date}</td>\r\n\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t})}\r\n\t\t\t\t</tbody>\r\n\t\t\t</table>\r\n\t\t</div>\r\n\t)\r\n}\r\n","import React, { useState } from 'react'\r\n\r\nimport { Link, useLocation, Redirect } from 'react-router-dom'\r\n\r\nimport { deleteProject } from '../views/Editor'\r\n\r\nconst styles = {\r\n\ttopBar: {\r\n\t\tbackgroundColor: '#212426',\r\n\t\twidth: '100%',\r\n\t\theight: '70px',\r\n\t\tdisplay: 'flex'\r\n\t},\r\n\tbarItem: {\r\n\t\tdisplay: 'flex',\r\n\t\tflexDirection: 'column',\r\n\t\tjustifyContent: 'center',\r\n\t\theight: 'auto',\r\n\t\tmarginLeft: '20px',\r\n\t\ttextDecoration: 'none',\r\n\t\tcolor: 'white'\r\n\t},\r\n\ttitle: {\r\n\t\tmarginRight: '85px',\r\n\t\tfontWeight: 'bold',\r\n\t\tfontSize: '125%'\r\n\t},\r\n\tdelete: {\r\n\t\tposition: 'absolute',\r\n\t\ttop: '21px',\r\n\t\tright: '50%',\r\n\t\tcolor: '#FCC'\r\n\t}\r\n}\r\n\r\nexport default function TopBar(props) {\r\n\tconst location = useLocation();\r\n\tconst [redir, setRedir] = useState(false);\r\n\tlet path = location.pathname.split('/');\r\n\r\n\tconst logout = () => {\r\n\t\tprops.setToken(null);\r\n\t\tlocalStorage.removeItem('token');\r\n\t\tsetRedir(true);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div style={styles.topBar}>\r\n\t\t\t{redir ?\r\n\t\t\t\t<Redirect to={{ pathname: '/FinalProject/' }} />\r\n\t\t\t\t: ''}\r\n\t\t\t<Link to='/FinalProject/' style={{ ...styles.barItem, ...styles.title }}>Fragflow</Link>\r\n\t\t\t{props.isSaved !== null ?\r\n\t\t\t\t<>\r\n\t\t\t\t\t<div style={styles.barItem}>{props.projName}</div>\r\n\t\t\t\t\t{props.isSaved ?\r\n\t\t\t\t\t\t<div style={{ ...styles.barItem, color: 'dimgray' }}>{props.isSaved}</div>\r\n\t\t\t\t\t\t:\r\n\t\t\t\t\t\t<div style={{ ...styles.barItem, color: 'yellow' }}>Ctrl+S to Save</div>}\r\n\t\t\t\t\t{props.isSaved !== ' ' && !path.includes('new') ?\r\n\t\t\t\t\t\t<div onClick={deleteProject}\r\n\t\t\t\t\t\t\tstyle={{ ...styles.barItem, ...styles.delete, userSelect: 'none' }}>\r\n\t\t\t\t\t\t\tDelete Project\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t: ''}\r\n\t\t\t\t</>\r\n\t\t\t\t: ''}\r\n\t\t\t{!path.includes('editor') ?\r\n\t\t\t\t<Link to='/FinalProject/editor/new' style={{ ...styles.barItem, color: 'lightgray' }}>New Project</Link>\r\n\t\t\t\t: ''}\r\n\t\t\t{props.token ?\r\n\t\t\t\t<>\r\n\t\t\t\t\t<div style={{ margin: 'auto' }}></div>\r\n\t\t\t\t\t<div style={{ ...styles.barItem }}>{props.user.name}</div>\r\n\t\t\t\t\t<div onClick={logout} style={{ ...styles.barItem, color: 'gray', userSelect: 'none' }}>\r\n\t\t\t\t\t\tLog Out\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</>\r\n\t\t\t\t:\r\n\t\t\t\t<>\r\n\t\t\t\t\t{path.includes('new') ?\r\n\t\t\t\t\t\t<div style={{ ...styles.barItem, color: 'orange' }}>\r\n\t\t\t\t\t\t\tYou must be logged in to save a project\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t: ''}\r\n\t\t\t\t\t<div style={{ margin: 'auto' }}></div>\r\n\t\t\t\t\t<Link to='/FinalProject/login' style={{ ...styles.barItem, color: 'lightgray' }}>Log In</Link>\r\n\t\t\t\t\t<Link to='/FinalProject/register' style={{ ...styles.barItem, color: 'lightgray' }}>Register</Link>\r\n\t\t\t\t</>\r\n\t\t\t}\r\n\t\t\t<div style={{ margin: '20px' }}></div>\r\n\t\t</div>\r\n\t)\r\n}\r\n","import React, { useState, useEffect } from 'react'\r\nimport axios from 'axios'\r\n\r\nimport { Switch, Route, Redirect, useLocation } from 'react-router-dom'\r\n\r\nimport Editor from './views/Editor'\r\nimport Register from './views/Register'\r\nimport Login from './views/Login'\r\nimport Home from './views/Home'\r\n\r\nimport TopBar from './components/TopBar'\r\n\r\nimport { baseURL } from './global-consts'\r\n\r\nimport './App.css'\r\n\r\nfunction App() {\r\n\tconst location = useLocation();\r\n\tconst [isSaved, setIsSaved] = useState(null);\r\n\tconst [token, setToken] = useState(localStorage.getItem('token'));\r\n\tconst [user, setUser] = useState({ name: '...', id: -1 });\r\n\tconst [projName, setProjName] = useState('...');\r\n\t// Don't show the page until we've determined whether or not the user's token is valid\r\n\tconst [isLoaded, setIsLoaded] = useState(false);\r\n\r\n\tuseEffect(() => {\r\n\t\tlet path = location.pathname.split('/');\r\n\t\tif (!path.includes('editor')) {\r\n\t\t\tsetIsSaved(null);\r\n\t\t}\r\n\t}, [location]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (token) {\r\n\t\t\taxios.get(`${baseURL}/api/user?token=${token}`).then((response) => {\r\n\t\t\t\tsetUser(response.data);\r\n\t\t\t\tsetIsLoaded(true);\r\n\t\t\t}).catch((error) => {\r\n\t\t\t\tsetToken(null);\r\n\t\t\t\tsetIsLoaded(true);\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tsetIsLoaded(true);\r\n\t\t}\r\n\t}, [token]);\r\n\r\n\tif (isLoaded) {\r\n\t\treturn (\r\n\t\t\t<div style={{ display: 'flex', flexDirection: 'column', height: '100vh' }}>\r\n\t\t\t\t<TopBar isSaved={isSaved} token={token} user={user}\r\n\t\t\t\t\tsetToken={setToken} projName={projName} />\r\n\t\t\t\t<Switch>\r\n\t\t\t\t\t<Route exact path='/FinalProject/editor'><Redirect to={{ pathname: '/FinalProject/editor/new' }} /></Route>\r\n\t\t\t\t\t<Route path='/FinalProject/editor'>\r\n\t\t\t\t\t\t<Editor isSaved={isSaved} setIsSaved={setIsSaved} setProjName={setProjName}\r\n\t\t\t\t\t\t\ttoken={token} user={user} projName={projName} />\r\n\t\t\t\t\t</Route>\r\n\t\t\t\t\t<Route exact path='/FinalProject/'><Home token={token} user={user} /></Route>\r\n\t\t\t\t\t<Route exact path='/FinalProject/login'><Login setToken={setToken} /></Route>\r\n\t\t\t\t\t<Route exact path='/FinalProject/register'><Register setToken={setToken} /></Route>\r\n\t\t\t\t</Switch>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\treturn (\r\n\t\t<div />\r\n\t)\r\n}\r\n\r\nexport default App;\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport App from './App';\r\nimport { BrowserRouter as Router } from 'react-router-dom'\r\n\r\nReactDOM.render(\r\n\t<Router>\r\n\t\t<App />\r\n\t</Router>,\r\n\tdocument.getElementById('root')\r\n);\r\n"],"sourceRoot":""}